{"version":3,"sources":["../src/state_change.js"],"names":["define","$","Ajax","Notification","t","SELECTOR","STATE_SELECT","CHANGE_STATE_BUTTON","STATE_VALUE_INPUT","SUBMIT_STATE_BUTTON","CHANGE_STATE_NOTIFICATION","init","document","ready","stateChangeSelect","changeStateButton","stateValueInput","submitStateButton","lastSelectedState","val","on","removeAttr","attr","pendingPromise","addPendingJSPromise","require","LoadingIcon","parentElement","addIconToContainerRemoveOnCompletion","args","courseid","cmid","questionid","state","failure","promise","call","methodname","then","results","alert","status","message","resolve","window","opener","location","reload","fail","pendingKey","M","util","js_pending","Deferred","js_complete","arguments","catch","exception"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript for state change dialog\n *\n * @package mod_studentquiz\n * @author Huong Nguyen <huongnv13@gmail.com>\n * @copyright 2019 HSR (http://www.hsr.ch)\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n\n    var t = {\n\n        SELECTOR: {\n            STATE_SELECT: '#menustatetype',\n            CHANGE_STATE_BUTTON: 'div.singlebutton.continue_state_change [type=submit]',\n            STATE_VALUE_INPUT: 'input[name=state]',\n            SUBMIT_STATE_BUTTON: '#change_state',\n            CHANGE_STATE_NOTIFICATION: 'span.change-question-state'\n        },\n\n        init: function() {\n            $(document).ready(function() {\n                var stateChangeSelect = $(t.SELECTOR.STATE_SELECT);\n                var changeStateButton = $(t.SELECTOR.CHANGE_STATE_BUTTON);\n                var stateValueInput = $(t.SELECTOR.STATE_VALUE_INPUT);\n                var submitStateButton = $(t.SELECTOR.SUBMIT_STATE_BUTTON);\n                var lastSelectedState = stateChangeSelect.val();\n\n                stateChangeSelect.on('change', function() {\n                    if (stateChangeSelect.val() !== '' && stateChangeSelect.val() !== lastSelectedState) {\n                        stateValueInput.val(stateChangeSelect.val());\n                        changeStateButton.removeAttr('disabled');\n                        submitStateButton.removeAttr('disabled');\n                    } else {\n                        changeStateButton.attr('disabled', 'disabled');\n                        submitStateButton.attr('disabled', 'disabled');\n                    }\n                });\n\n                submitStateButton.on('click', function() {\n                    submitStateButton.attr('disabled', 'disabled');\n                    var pendingPromise = t.addPendingJSPromise('studentquizStateChange');\n                    require(['core/loadingicon'], function(LoadingIcon) {\n                        var parentElement = $(t.SELECTOR.CHANGE_STATE_NOTIFICATION);\n                        LoadingIcon.addIconToContainerRemoveOnCompletion(parentElement, pendingPromise);\n                    });\n                    var args = {\n                        courseid: submitStateButton.attr('data-courseid'),\n                        cmid: submitStateButton.attr('data-cmid'),\n                        questionid: submitStateButton.attr('data-questionid'),\n                        state: stateChangeSelect.val()\n                    };\n                    var failure;\n                    var promise = Ajax.call([{methodname: 'mod_studentquiz_set_state', args: args}], true, true);\n                    promise[0].then(function(results) {\n                        Notification.alert(results.status, results.message);\n                        pendingPromise.resolve();\n                        lastSelectedState = stateChangeSelect.val();\n                        // Reload the Studentquiz page.\n                        window.opener.location.reload();\n                        // Each then() should return a value or throw (promise/always-return).\n                        return;\n                    }).fail(failure);\n                });\n            });\n        },\n\n        /**\n         * Add Pending Promise to current session.\n         *\n         *\n         * @param {string} pendingKey JSPending key\n         * @returns {*|jQuery|{}} Pending Promise\n         */\n        addPendingJSPromise: function(pendingKey) {\n            M.util.js_pending(pendingKey);\n\n            var pendingPromise = $.Deferred();\n            pendingPromise.then(function() {\n                M.util.js_complete(pendingKey);\n                return arguments[0];\n            }).catch(Notification.exception);\n\n            return pendingPromise;\n        },\n    };\n\n    return t;\n});\n"],"file":"state_change.min.js"}